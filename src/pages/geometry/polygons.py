import streamlit as st
import numpy as np
import matplotlib.pyplot as plt
from ...components.polygon_drawer import draw_polygon_component

def plot_regular_polygon(n, size=1):
    """ç»˜åˆ¶æ­£nè¾¹å½¢"""
    angles = np.linspace(0, 2*np.pi, n, endpoint=False)
    x = size * np.cos(angles)
    y = size * np.sin(angles)
    
    fig, ax = plt.subplots(figsize=(4, 4))
    ax.plot(np.append(x, x[0]), np.append(y, y[0]), 'b-')
    ax.set_aspect('equal')
    ax.grid(True)
    ax.set_title(f'æ­£{n}è¾¹å½¢')
    plt.close()
    return fig

def show_polygons_page():
    """æ˜¾ç¤ºå¤šè¾¹å½¢é¡µé¢"""
    st.title("å¤šè¾¹å½¢æ¢ç´¢ ğŸ”·")
    
    # åˆ›å»ºé€‰é¡¹å¡
    tab1, tab2, tab3, tab4 = st.tabs([
        "å¤šè¾¹å½¢åŸºç¡€",
        "æ­£å¤šè¾¹å½¢",
        "å¤šè¾¹å½¢æ€§è´¨",
        "è¶£å‘³çŸ¥è¯†"
    ])
    
    # Tab 1: å¤šè¾¹å½¢åŸºç¡€
    with tab1:
        st.markdown("""
        ## ä»€ä¹ˆæ˜¯å¤šè¾¹å½¢ï¼Ÿ
        
        å¤šè¾¹å½¢æ˜¯ç”±**æœ‰é™ä¸ªçº¿æ®µ**é¦–å°¾ç›¸è¿æ„æˆçš„**å°é—­**å¹³é¢å›¾å½¢ã€‚è¿™äº›çº¿æ®µç§°ä¸ºå¤šè¾¹å½¢çš„**è¾¹**ï¼Œçº¿æ®µçš„ç«¯ç‚¹ç§°ä¸ºå¤šè¾¹å½¢çš„**é¡¶ç‚¹**ã€‚
        
        ### å¤šè¾¹å½¢çš„åŸºæœ¬è¦ç´ 
        1. **é¡¶ç‚¹**ï¼šå¤šè¾¹å½¢çš„è§’çš„ä½ç½®
        2. **è¾¹**ï¼šè¿æ¥é¡¶ç‚¹çš„çº¿æ®µ
        3. **å†…è§’**ï¼šå¤šè¾¹å½¢å†…éƒ¨çš„è§’
        4. **å¤–è§’**ï¼šè¾¹çš„å»¶é•¿çº¿ä¸ç›¸é‚»è¾¹å½¢æˆçš„è§’
        
        ### å¤šè¾¹å½¢çš„åˆ†ç±»
        
        æ ¹æ®è¾¹çš„æ•°é‡ï¼š
        - ä¸‰è§’å½¢ï¼ˆ3è¾¹ï¼‰
        - å››è¾¹å½¢ï¼ˆ4è¾¹ï¼‰
        - äº”è¾¹å½¢ï¼ˆ5è¾¹ï¼‰
        - å…­è¾¹å½¢ï¼ˆ6è¾¹ï¼‰
        - ...
        
        æ ¹æ®å½¢çŠ¶ç‰¹å¾ï¼š
        - **å‡¸å¤šè¾¹å½¢**ï¼šä»»æ„ä¸¤ä¸ªé¡¶ç‚¹çš„è¿çº¿éƒ½åœ¨å¤šè¾¹å½¢å†…éƒ¨
        - **å‡¹å¤šè¾¹å½¢**ï¼šå­˜åœ¨ä¸¤ä¸ªé¡¶ç‚¹çš„è¿çº¿ä¸å®Œå…¨åœ¨å¤šè¾¹å½¢å†…éƒ¨
        
        æ ¹æ®è¾¹å’Œè§’çš„å…³ç³»ï¼š
        - **æ­£å¤šè¾¹å½¢**ï¼šæ‰€æœ‰è¾¹é•¿ç›¸ç­‰ä¸”æ‰€æœ‰è§’ç›¸ç­‰
        - **ä¸è§„åˆ™å¤šè¾¹å½¢**ï¼šè¾¹é•¿æˆ–è§’åº¦ä¸å…¨ç›¸ç­‰
        """)
        
        # æ·»åŠ å‡¸å¤šè¾¹å½¢å’Œå‡¹å¤šè¾¹å½¢çš„ç¤ºæ„å›¾
        col1, col2 = st.columns(2)
        with col1:
            st.image("https://upload.wikimedia.org/wikipedia/commons/thumb/6/61/Convex_polygon_illustration3.svg/220px-Convex_polygon_illustration3.svg.png", caption="å‡¸å¤šè¾¹å½¢")
        with col2:
            st.image("https://upload.wikimedia.org/wikipedia/commons/thumb/b/b3/Concave_polygon_illustration3.svg/220px-Concave_polygon_illustration3.svg.png", caption="å‡¹å¤šè¾¹å½¢")
    
    # Tab 2: æ­£å¤šè¾¹å½¢
    with tab2:
        st.markdown("""
        ## æ­£å¤šè¾¹å½¢
        
        æ­£å¤šè¾¹å½¢æ˜¯æœ€ç¾çš„å¤šè¾¹å½¢ï¼Œå®ƒå…·æœ‰å®Œç¾çš„å¯¹ç§°æ€§ã€‚
        
        ### æ­£å¤šè¾¹å½¢çš„æ€§è´¨
        1. æ‰€æœ‰è¾¹é•¿ç›¸ç­‰
        2. æ‰€æœ‰å†…è§’ç›¸ç­‰
        3. æ‰€æœ‰é¡¶ç‚¹åˆ°ä¸­å¿ƒçš„è·ç¦»ï¼ˆåŠå¾„ï¼‰ç›¸ç­‰
        4. æœ‰ç›¸ç­‰æ•°é‡çš„å¯¹ç§°è½´
        
        ### æ­£å¤šè¾¹å½¢çš„å†…è§’
        - å†…è§’å¤§å° = (n-2) Ã— 180Â° Ã· n
        - ä¾‹å¦‚ï¼šæ­£å…­è¾¹å½¢çš„æ¯ä¸ªå†…è§’ = (6-2) Ã— 180Â° Ã· 6 = 120Â°
        """)
        
        # æ·»åŠ æ­£å¤šè¾¹å½¢ç¤ºä¾‹
        col1, col2, col3 = st.columns(3)
        with col1:
            st.pyplot(plot_regular_polygon(3))
            st.markdown("æ­£ä¸‰è§’å½¢")
        with col2:
            st.pyplot(plot_regular_polygon(4))
            st.markdown("æ­£æ–¹å½¢")
        with col3:
            st.pyplot(plot_regular_polygon(6))
            st.markdown("æ­£å…­è¾¹å½¢")
            
        st.markdown("### äº¤äº’å¼æ­£å¤šè¾¹å½¢ç»˜åˆ¶å™¨")
        st.markdown("è°ƒæ•´è¾¹æ•°å’Œå¤§å°ï¼Œè§‚å¯Ÿæ­£å¤šè¾¹å½¢çš„å˜åŒ–ï¼š")
        draw_polygon_component()
    
    # Tab 3: å¤šè¾¹å½¢æ€§è´¨
    with tab3:
        st.markdown("""
        ## å¤šè¾¹å½¢çš„é‡è¦æ€§è´¨
        
        ### 1. å†…è§’å’Œ
        nè¾¹å½¢çš„å†…è§’å’Œ = (n-2) Ã— 180Â°
        
        ä¾‹å¦‚ï¼š
        - ä¸‰è§’å½¢ï¼š(3-2) Ã— 180Â° = 180Â°
        - å››è¾¹å½¢ï¼š(4-2) Ã— 180Â° = 360Â°
        - äº”è¾¹å½¢ï¼š(5-2) Ã— 180Â° = 540Â°
        
        ### 2. å¤–è§’å’Œ
        ä»»ä½•å¤šè¾¹å½¢çš„å¤–è§’å’Œéƒ½ç­‰äº360Â°ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ç¥å¥‡çš„æ€§è´¨ï¼
        
        ### 3. å¯¹è§’çº¿çš„æ•°é‡
        nè¾¹å½¢çš„å¯¹è§’çº¿æ•°é‡ = n(n-3) Ã· 2
        
        ä¾‹å¦‚ï¼š
        - ä¸‰è§’å½¢ï¼š3(3-3) Ã· 2 = 0 æ¡
        - å››è¾¹å½¢ï¼š4(4-3) Ã· 2 = 2 æ¡
        - äº”è¾¹å½¢ï¼š5(5-3) Ã· 2 = 5 æ¡
        
        ### 4. å¤šè¾¹å½¢çš„é¢ç§¯
        - **è§„åˆ™å¤šè¾¹å½¢**ï¼šé¢ç§¯ = å‘¨é•¿ Ã— åŠå¾„ Ã· 2
        - **ä¸è§„åˆ™å¤šè¾¹å½¢**ï¼šå¯ä»¥é€šè¿‡ä¸‰è§’å‰–åˆ†æ³•è®¡ç®—
        """)
        
        # æ·»åŠ é¢ç§¯è®¡ç®—å™¨
        st.markdown("### æ­£å¤šè¾¹å½¢é¢ç§¯è®¡ç®—å™¨")
        col1, col2 = st.columns(2)
        with col1:
            sides = st.number_input("è¾¹æ•°", min_value=3, max_value=12, value=6, key="geometry_polygons_calc_sides")
            side_length = st.number_input("è¾¹é•¿", min_value=0.1, max_value=100.0, value=1.0, key="geometry_polygons_calc_side_length")
        with col2:
            # è®¡ç®—é¢ç§¯
            angle = np.pi / sides
            radius = side_length / (2 * np.sin(angle))
            area = sides * side_length * radius / 2
            st.metric("é¢ç§¯", f"{area:.2f} å¹³æ–¹å•ä½")
    
    # Tab 4: è¶£å‘³çŸ¥è¯†
    with tab4:
        st.markdown("""
        ## å¤šè¾¹å½¢çš„è¶£å‘³çŸ¥è¯†
        
        ### 1. èœ‚å·¢çš„å¥¥ç§˜
        èœœèœ‚å»ºé€ çš„èœ‚å·¢ä¸ºä»€ä¹ˆæ˜¯å…­è¾¹å½¢çš„ï¼Ÿè¿™æ˜¯å› ä¸ºæ­£å…­è¾¹å½¢æ˜¯æ‰€æœ‰æ­£å¤šè¾¹å½¢ä¸­æœ€æ¥è¿‘åœ†å½¢ï¼Œ
        ä¸”èƒ½å¤Ÿå®Œå…¨é“ºæ»¡å¹³é¢çš„å½¢çŠ¶ï¼Œè¿™æ ·æ—¢èŠ‚çœææ–™åˆä¿è¯å¼ºåº¦ã€‚
        
        ### 2. é«˜æ–¯ä¸17è¾¹å½¢
        19å²çš„é«˜æ–¯è¯æ˜äº†æ­£17è¾¹å½¢å¯ä»¥ç”¨å°ºè§„ä½œå›¾æ„é€ ï¼Œè¿™ä¸ªå‘ç°è®©ä»–å†³å®šç»ˆèº«çŒ®èº«äºæ•°å­¦ç ”ç©¶ã€‚
        å®é™…ä¸Šï¼Œå¯ä»¥ç”¨å°ºè§„ä½œå›¾çš„æ­£å¤šè¾¹å½¢çš„è¾¹æ•°å¿…é¡»æ˜¯ä»¥ä¸‹å½¢å¼ï¼š
        - 2çš„å¹‚ï¼ˆ4, 8, 16, ...ï¼‰
        - è´¹é©¬ç´ æ•°ï¼ˆ3, 5, 17, 257, ...ï¼‰
        - ä»¥ä¸Šä¸¤ç§æ•°çš„ä¹˜ç§¯
        
        ### 3. è‡ªç„¶ç•Œä¸­çš„å¤šè¾¹å½¢
        - é›ªèŠ±å‘ˆç°å…­è¾¹å½¢ç»“æ„
        - ç„æ­¦å²©æŸ±å¤šå‘ˆå…­è¾¹å½¢
        - çŸ³æ¦´çŸ³æ™¶ä½“å‘ˆç°åäºŒé¢ä½“
        - èœ‚å·¢å‘ˆç°è§„åˆ™å…­è¾¹å½¢
        
        ### 4. ç”Ÿæ´»ä¸­çš„å¤šè¾¹å½¢
        - äº¤é€šæ ‡å¿—ï¼šå…«è¾¹å½¢ï¼ˆåœè½¦æ ‡å¿—ï¼‰ã€ä¸‰è§’å½¢ï¼ˆè­¦å‘Šï¼‰
        - å»ºç­‘è®¾è®¡ï¼šäº”è§’å¤§æ¥¼ï¼ˆäº”è¾¹å½¢ï¼‰
        - è¿åŠ¨åœºï¼šè¶³çƒï¼ˆäº”è¾¹å½¢å’Œå…­è¾¹å½¢çš„ç»„åˆï¼‰
        """)
        
        # æ·»åŠ ä¸€äº›è¶£å‘³å›¾ç‰‡
        st.image("https://upload.wikimedia.org/wikipedia/commons/thumb/3/37/Basalt_Columns_in_Iceland.jpg/640px-Basalt_Columns_in_Iceland.jpg", 
                 caption="è‡ªç„¶ç•Œä¸­çš„å…­è¾¹å½¢ï¼šç„æ­¦å²©æŸ±")